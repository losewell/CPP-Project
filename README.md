C++ 线程池连接 与mysql连接池的实现

#编译方式：修改CMakeLists.txt 有些目录修改成自己操作系统下的目录;

#修改config.h 将数据库相关地址用户名 数据库名称修改掉；

namespace sqlinfo {

        static const char *db_pool_name = "mypool";
        static const char* db_host = "127.0.0.1";
        static const int   db_port = 3306;
        static const char* db_dbname = "test_pool";
        static const char* db_username = "root";
        static const char* db_password = "12345678";
        static const int   db_maxconncnt = 4;

};

#cmake .

#make 

#生成两个可执行文件main_DBPool  main_ThreadPool
#./main_DBPool
#main_DBPool 是刚开始测试数据库连接 以及一些增删改查操作的demo

#./main_ThreadPool 2 2 1 1000
#main_ThreadPool 后面4个参数 分别代表 线程数 连接数  是否使用连接池  插入数据数量
使用连接池时，一般线程数和连接数保持一致；不用连接池时，代码中实现的是新建连接，此处参数用不到，1000 代表进行1000条数据插入。


#使用连接池，用一个线程和一个连接插入1000条数据

#./main_ThreadPool 1 1 1 1000  

#不使用连接池，用1个线程1000条数据

#./main_ThreadPool 1 1 0 1000 

#使用连接池，用2个线程和2个连接插入1000条数据

#./main_ThreadPool 2 2 1 1000  

#不使用连接池，用2个线程1000条数据

#./main_ThreadPool 2 2 0 1000 

=================================================================


各个类功能描述：

Common：创建数据库表的字段

config:mysql数据连接信息的配置

DBConn：数据库操作API的封装，包括连接，查询，执行sql语句的操作。

DBPool：管理多个数据库连接（DBConn），创建连接，回收连接，获取连接等操作；

ThreadNotify：互斥锁以及信号量的封装，供多线程处理某些操作进行加锁，等待信号量等。

ThreadPool：管理线程，维护任务队列；线程的初始化 销毁等操作。

TableOperator：数据表的操作（针对具体的表），后面可以按照统一格式进行添加其他表。

ResultSet：数据库数据select之后解析数据的类

PrepareStatement：进行数据insert之前对数据进行处理的类。

main_ThreadPool.cpp:主函数：
  主要流程：
  1.线程池的初始化操作：创建连接放入list中
  
  2.从连接池获取连接，创建相应数据表
  
  3.归还连接到连接池中
  
  4.创建线程池，初始化线程，设置回调函数
  
  5.将任务（插入数据的操作）添加到线程池队列中
  
  6.任务执行完，释放资源操作（等待队列为空信号）

任务添加到队列流程（上面步骤5）：
  1.任务队列满则进行等待
  
  2.初始化任务结构体，设置回调函数，参数
  
  3.放入队列，触发队列非空信号
 
  
线程回调函数（主要流程中的4）：
  1.队列为空，则进行等待 队列不为空（上面步骤3触发）
  
  2.从队列中取出任务（取出后若队列为空，发送队列为空信号；队列从满变为不满，发送队列不满信号）
  
  3.执行任务
  
      1.使用连接池：从连接池中获取连接，获取操作数据，对数据库进行操作，归还连接到连接池
      
      2.不使用连接池：创建连接，获取操作数据，对数据库进行操作，销毁连接
      
  4.释放任务。
  
===================================================================================


我使用的数据库和运行的程序都在同一台物理机上，多线程操作数据库同等条件下使用和不使用连接池情况下 相差大约300 ms；

如果二者不再同一台物理机上，运行后时间差距或许更加多一些。
